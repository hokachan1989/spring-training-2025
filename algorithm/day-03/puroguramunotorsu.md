# プログラムのトレース

### トレースとは？

**トレース**とは、プログラムの実行過程を1行ずつ追跡し、各ステップでの変数の値や状態の変化を確認する作業です。プログラムが「どのように動作しているか」を理解するための重要な技術です。

* **日常生活の例**
  * レシピの手順を1つずつ確認しながら料理を作る
  * 組み立て説明書の手順に沿って家具を組み立てる
  * 数学の問題を解く過程で各ステップの計算を順番に書き出す

> 📝 **ポイント**: トレースはプログラムの「動き」を目で見える形にすることで、バグの発見や処理の理解に役立ちます。

### トレースの基本手順

1. プログラムの各行を順番に実行していく
2. 変数の値がどのように変化するかを記録する
3. 条件分岐やループがある場合は、実行される経路を追跡する
4. 必要に応じて、予想される出力と実際の出力を比較する

### トレース表の種類

#### 1. 処理列を含むトレース表

```
| 処理       | x  | y  | 計算過程 |
|-----------|----|----|---------|
| x = 5     | 5  | -  |         |
| y = x + 3 | 5  | 8  | 5+3=8   |
| x = x * 2 | 10 | 8  | 5*2=10  |
| y = x + y | 10 | 18 | 10+8=18 |
```

#### 2. 処理列を省略したシンプルなトレース表

```
| x  | y  | 備考    |
|----|----|---------| 
| 5  | -  | 初期値   |
| 5  | 8  | y=x+3   |
| 10 | 8  | x=x*2   |
| 10 | 18 | y=x+y   |
```

### 例1: シンプルな変数操作のトレース

```python
x = 5
y = x + 3
x = x * 2
y = x + y
```

**シンプルなトレース表**:

```
| x  | y  | 備考     |
|----|----|---------| 
| 5  | -  | 初期値   |
| 5  | 8  | y=x+3   |
| 10 | 8  | x=x*2   |
| 10 | 18 | y=x+y   |
```

### 例2: ループを使った合計計算

```python
# 1から5までの数を合計
count = 0
total = 0

for num in range(1, 6):
    count = count + 1
    total = total + num
    print(f"ステップ{count}: {num}を加えて、合計は{total}")
```

**シンプルなトレース表**:

```
| num | count | total | 備考 　    |
|-----|-------|-------|-----------|
| -   | 0     | 0     | 初期値     |
| 1   | 1     | 1     | total=0+1 |
| 2   | 2     | 3     | total=1+2 |
| 3   | 3     | 6     | total=3+3 |
| 4   | 4     | 10    | total=6+4 |
| 5   | 5     | 15    | total=10+5|
```

### 例3: 条件分岐による成績判定

```python
score = 85

if score >= 90:
    grade = "A"
elif score >= 80:
    grade = "B"
elif score >= 70:
    grade = "C"
else:
    grade = "D"
```

**シンプルなトレース表**:

```
| score | grade | 条件判断                     |
|-------|-------|-----------------------------|
| 85    | -     | score>=90? False            |
| 85    | -     | score>=80? True             |
| 85    | "B"   | 条件を満たす → grade="B"を代入 |
```

### 例4: 素数判定アルゴリズム

```python
# 素数判定プログラム
number = 17
is_prime = True

if number <= 1:
    is_prime = False
else:
    for i in range(2, int(number ** 0.5) + 1):
        if number % i == 0:
            is_prime = False
            break
```

**シンプルなトレース表**:

```
| i | number | is_prime | number % i | 判断                   |
|---|--------|----------|-----------|------------------------|
| - | 17     | True     | -         | number<=1? False       |
| 2 | 17     | True     | 1         | 17÷2=8余り1, 割り切れない |
| 3 | 17     | True     | 2         | 17÷3=5余り2, 割り切れない |
| 4 | 17     | True     | 1         | 17÷4=4余り1, 割り切れない |
| - | 17     | True     | -         | 結果: 17は素数           |
```

### トレースの重要性

* **バグの発見**：エラーが発生した場合、トレースでプログラムの挙動を追跡し、問題の原因を特定できる
* **アルゴリズムの理解**：複雑なアルゴリズムの動作を一歩ずつ確認することで理解が深まる
* **最適化の検討**：無駄な処理や重複計算を発見し、効率化の方針を立てられる

### トレースのコツ

* **目的に応じたトレース表を選ぶ**：詳細に追跡したい場合は処理列を含め、データの流れに注目する場合は省略する
* **計算過程も記録する**：「10+5=15」のように計算過程を書くと、ミスの発見が容易になる
* **条件判断は明示的に**：「85>=90 False」のように条件式の評価結果を明示する
* **紙とペンを活用する**：手書きでトレースすることで、プログラムの流れがより明確になる
* **予測と検証を繰り返す**：「次はこうなるだろう」と予測してから確認する習慣をつける

> 📝 **ポイント**: トレースは単なる作業ではなく、プログラムの「思考過程」を理解するための手段です。定期的にトレースする習慣をつけることで、プログラミングスキルが向上します。

### 演習問題

#### 問題 1: シンプルな計算のトレース

以下のコードをトレースして、最後の`x`と`y`の値を求めてください。

```python
x = 10
y = 5
x = x - y
y = y + x
x = x * 2
```

<details>

<summary>ヒント</summary>

各行で変数がどのように変化するかを順番に追跡します。

</details>

#### 問題 2: 条件分岐のトレース

以下のコードをトレースして、`result`の最終的な値を求めてください。

```python
a = 8
b = 12

if a > 10:
    result = a * 2
elif b > 10:
    result = b * 2
else:
    result = a + b
```

<details>

<summary>ヒント</summary>

条件式の評価結果（True/False）を確認し、実行される分岐をたどります。

</details>

#### 問題 3: ループのトレース

以下のコードをトレースして、`sum`の最終的な値を求めてください。

```python
sum = 0
for i in range(1, 5):
    if i % 2 == 0:
        sum = sum + i
    else:
        sum = sum + 1
```

<details>

<summary>ヒント</summary>

* range(1, 5) は1, 2, 3, 4 を生成します

- i % 2 == 0 は偶数かどうかをチェックします

* 各ループで sum の値がどう変化するか追跡しましょう

</details>
