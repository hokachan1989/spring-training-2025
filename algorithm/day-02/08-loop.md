# 8. Python: ループ構造

### 8.1 ループの概念と重要性

ループ (繰り返し) は、同じ処理を何度も実行するための基本的なプログラミング構造です。アルゴリズムにおいては、データの探索やソートなど、多くの処理でループが使われます。

#### ループの必要性

プログラミングでは、同じ処理を何度も記述する代わりに、ループを使って簡潔に表現できます。

```python
# ループを使わない場合 (同じ処理を繰り返し記述)
print("こんにちは")
print("こんにちは")
print("こんにちは")
print("こんにちは")
print("こんにちは")

# ループを使った場合 (簡潔に表現)
for i in range(5):
    print("こんにちは")
```

両方のコードは同じ結果を生みますが、ループを使った方が簡潔で、繰り返し回数の変更も容易です。

#### アルゴリズムにおけるループの役割

アルゴリズムを実装する際、ループは以下のような場面で必要となります。

* データ集合 (リスト) 内の各要素を処理する
* 一定回数の処理を繰り返す
* 特定の条件が満たされるまで処理を続ける
* 入力値の検証を繰り返す

> 📝 **ポイント**: ループの理解は、アルゴリズムを実装する上で非常に重要です。Python では主に `for` ループと `while` ループの 2 種類があり、状況に応じて使い分けます。

### 8.2 for ループの基本構造

`for` ループは、指定した範囲や集合の各要素に対して、一定の処理を繰り返し実行するための構造です。

```python
# for ループの基本構文
for 変数 in シーケンス:
    # 繰り返し実行したい処理
```

{% hint style="info" %}
ここで 「シーケンス」 とは、リスト、タプル、文字列、range オブジェクトなど、複数の要素を持つデータ構造を指します。
{% endhint %}

#### range 関数を使った基本的な繰り返し

`range()` 関数は、数値の範囲を生成するのに便利な関数です。

```python
# 基本的な for ループ (0 から 4 まで)
for i in range(5):
    print(i)
```

<details>

<summary>実行結果</summary>

```
0
1
2
3
4
```

</details>

#### range 関数のバリエーション ⭐️

`range()` 関数にはいくつかの使い方があります：

```python
# range(開始値, 終了値): 開始値 から 終了値-1 までの数値を生成
for i in range(2, 6):
    print(i)
```

<details>

<summary>実行結果</summary>

```
2
3
4
5
```

</details>

```python
# range(開始値, 終了値, ステップ): 指定したステップで数値を生成
for i in range(0, 10, 2):
    print(i)
```

<details>

<summary>実行結果</summary>

```
0
2
4
6
8
```

</details>

> 📝 **ポイント**: `range(n)` は 0 から n-1 までの数値を生成します。つまり、n 個の数値が生成されますが、最大値は n-1 です。これはプログラミングでよく使われるインデックスの考え方 (0 から始まる) と合致しています。

### 8.3 リストに対する for ループ

リストの各要素を順番に処理する場合、`for` ループが最も自然な選択肢です。

#### リストの要素を直接処理

```python
fruits = ["りんご", "バナナ", "オレンジ", "ぶどう"]

# リストの各要素を直接処理
for fruit in fruits:
    print(fruit)
```

<details>

<summary>実行結果</summary>

```
りんご
バナナ
オレンジ
ぶどう
```

</details>

#### リスト内の要素を変換して新しいリストを作成 ⭐️

```python
numbers = [1, 2, 3, 4, 5]
squares = []

# 各数値の 2乗を計算して新しいリストに追加
for num in numbers:
    squares.append(num ** 2)

print(squares)
```

<details>

<summary>実行結果</summary>

```
[1, 4, 9, 16, 25]
```

</details>

> 📝 **ポイント**: 直接要素を処理する方法と、インデックスを使う方法があります。要素の値だけが必要な場合は直接処理、位置情報も必要な場合はインデックスを使います。

### 8.4 インデックスを使った for ループ

リストの要素だけでなく、そのインデックス (位置) も必要な場合があります。

#### range と len を組み合わせる方法

```python
fruits = ["りんご", "バナナ", "オレンジ", "ぶどう"]

# インデックスを使ったループ
for i in range(len(fruits)):
    print(f"インデックス {i}: {fruits[i]}")
```

<details>

<summary>実行結果</summary>

```
インデックス 0: りんご
インデックス 1: バナナ
インデックス 2: オレンジ
インデックス 3: ぶどう
```

</details>

> 📝 **ポイント**: `range(len(リスト))` を使うとインデックスを用いてリストの要素にアクセスできます。これはアルゴリズム実装でよく使われる方法です。

#### インデックスを使った要素の更新 ⭐️

```python
numbers = [10, 20, 30, 40, 50]

# インデックスを使って要素を更新
for i in range(len(numbers)):
    numbers[i] = numbers[i] * 2

print(numbers)
```

<details>

<summary>実行結果</summary>

```
[20, 40, 60, 80, 100]
```

</details>

### 8.5 while ループの基本構造

`while` ループは、指定した条件が真である限り、処理を繰り返し実行するための構造です。

```python
# while ループの基本構文
while 条件式:
    # 繰り返し実行したい処理
```

条件式が `True` である限り、中のコードブロックが繰り返し実行されます。

#### 基本的な while ループの例

```python
count = 1

while count <= 5:
    print(count)
    count += 1  # カウンターを増やす (これがないと無限ループになる)
```

<details>

<summary>実行結果</summary>

```
1
2
3
4
5
```

</details>

> 📝 **ポイント**: `while` ループでは、ループを抜ける条件を必ず設定しないと **無限ループ** になる危険性があります。通常、ループ内で条件に影響を与える変数の値を変更する必要があります。

### 8.6 for と while ループの使い分け

`for` ループと `while` ループはどちらも繰り返し処理を行いますが、適している状況が異なります。

#### for ループが適している場合

* 繰り返し回数が事前に分かっている場合
* シーケンス (リスト、文字列など) の各要素を処理する場合
* 範囲内のすべての数値を処理する場合

#### while ループが適している場合

* 終了条件が動的に変わる場合
* 条件が満たされるまで繰り返す場合
* ユーザー入力に基づいて処理を継続/終了する場合

> 📝 **ポイント**: 一般的に、処理すべき要素や回数が明確な場合は `for` ループを、終了条件だけが分かっている場合は `while` ループを使用します。

### 8.7 ループ制御文

ループの実行を制御するための特別な命令文があります。

#### break 文：ループを途中で終了

```python
# 5が見つかったらループを終了
numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
for num in numbers:
    if num == 5:
        print(f"{num}が見つかりました。ループを終了します。")
        break  # ループを即座に終了
    print(f"現在の数値: {num}")
```

<details>

<summary>実行結果</summary>

```
現在の数値: 1
現在の数値: 2
現在の数値: 3
現在の数値: 4
5が見つかりました。ループを終了します。
```

</details>

#### continue 文：現在の繰り返しをスキップ

```python
# 偶数だけを表示 (奇数をスキップ)
for num in range(1, 11):
    if num % 2 != 0:  # 奇数の場合
        continue  # 次の繰り返しに進む
    print(f"偶数: {num}")
```

<details>

<summary>実行結果</summary>

```
偶数: 2
偶数: 4
偶数: 6
偶数: 8
偶数: 10
```

</details>

> 📝 **ポイント**: `break` はループを完全に終了させ、`continue` は現在の繰り返しだけをスキップします。これらの制御文は、アルゴリズムの実装において条件に応じた処理の制御に重要です。

### 8.8 ネストしたループ ⭐️

ループの中に別のループを入れることで、より複雑な処理が可能になります。これを 「ネストしたループ」 と呼びます。

```python
# 簡単な九九の一部 (2段と3段)
for i in range(2, 4):
    print(f"{i}の段:")
    for j in range(1, 10):
        print(f"{i} x {j} = {i * j}")
    print("------")
```

<details>

<summary>実行結果</summary>

```
2の段:
2 x 1 = 2
2 x 2 = 4
2 x 3 = 6
2 x 4 = 8
2 x 5 = 10
2 x 6 = 12
2 x 7 = 14
2 x 8 = 16
2 x 9 = 18
------
3の段:
3 x 1 = 3
3 x 2 = 6
3 x 3 = 9
3 x 4 = 12
3 x 5 = 15
3 x 6 = 18
3 x 7 = 21
3 x 8 = 24
3 x 9 = 27
------
```

</details>

> 📝 **ポイント**: ネストしたループは、2次元データ (行列など) の処理でよく使われます。外側のループが1回実行されるごとに、内側のループが完全に実行されます。バブルソートなどのアルゴリズムでは、このネストしたループ構造が重要になります。

### 8.9 よくあるエラーと注意点

ループを使う際によく発生するエラーと、その対処法を紹介します。

#### 無限ループ

`while` ループでは、条件が常に真になってしまうと無限ループに陥ります。

```python
# 無限ループの例
counter = 1
while counter <= 5:
    print(counter)
    # counter += 1  # この行がないと counter が増えず、常に 1 のまま
```

対策：ループ内で条件に影響を与える変数を必ず更新しましょう。

#### インデックスエラー

リストのインデックスが範囲外になると `IndexError` が発生します。

```python
# インデックスエラーの例
numbers = [1, 2, 3, 4, 5]
for i in range(len(numbers) + 1):  # 範囲が大きすぎる
    print(numbers[i])  # i が 5 のとき IndexError が発生
```

対策：`range()` の範囲を正しく設定し、インデックスが有効範囲内にあることを確認しましょう。

> 📝 **ポイント**: デバッグの際には、ループの条件、インデックスの範囲、変数の値などを注意深く確認しましょう。`print()` を使って変数の値を表示することで、問題の特定が容易になります。



***

### 演習問題

#### 問題 8-1: 単純な繰り返し

for ループを使って、簡単な繰り返し処理を行うプログラムを作成してください。

```python
# 1. 1から5までの数字を順番に表示する
# range() 関数を使います


# 2. 「こんにちは」というメッセージを3回表示する
# range() 関数と繰り返し回数を組み合わせます


```

<details>

<summary>ヒント</summary>

* `for` ループの基本構文は `for 変数 in シーケンス:` です
* `range(n)` 関数は、0 から始まる n 個の数字のシーケンスを生成します
* `range(1, 6)` とすると、1 から 5 までの数字のシーケンスを生成します
* ループ内で実行したいコードは、インデントして記述します

</details>

#### 問題 8-2: range 関数のバリエーション

range 関数の様々な使い方を実践してください。

```python
# 1. 5 から 10 までの数字を順番に表示する
# range() 関数の開始値と終了値を指定します


# 2. 10 から 1 までの数字を逆順に表示する
# ヒント: range() 関数の開始値、終了値、ステップ (増分) を指定します


# 3. 0 から 20 までの偶数を表示する
# ヒント: range() 関数のステップを利用します


```

<details>

<summary>ヒント</summary>

* `range(開始値, 終了値)` は、開始値 から 終了値 -1 までの数字のシーケンスを生成します
* `range(開始値, 終了値, ステップ)` は、指定したステップ (増分) で数字を生成します
* 負のステップを使うと、数字を逆順に生成できます (例: `range(10, 0, -1)` )

</details>

#### 問題 8-3: リストの要素を処理する

リストとforループを組み合わせて、リストの要素を処理するプログラムを作成してください。

```python
fruits = ["りんご", "バナナ", "オレンジ", "ぶどう", "メロン"]

# 1. fruits の各要素を順番に表示する


# 2. fruitsの各要素と、その長さ (文字数) を一緒に表示する
# 例: 「りんご: 3文字」
# ヒント: len() 関数と文字列連結または f-string を使います

```

<details>

<summary>ヒント</summary>

* `for 変数 in リスト:` の形式で、リストの各要素に対してループ処理を行います
* `len(文字列)` 関数で、文字列の長さ (文字数) を取得できます
* f-string を使うと、`f"{変数}文字列{変数}"` のように変数を文字列内に埋め込めます

</details>

#### 問題 8-4: インデックスを使ったリストの処理

インデックスを使って、リストの要素を処理するプログラムを作成してください。

```python
numbers = [10, 20, 30, 40, 50]

# 1. numbers の各要素とそのインデックスを表示する
# 例: 「インデックス 0: 10」、「インデックス 1: 20」、...
# range() 関数とlen() 関数を組み合わせる


# 2. numbers の各要素を 2倍した値で更新する
# インデックスを使って要素にアクセスし、値を更新する


print("2倍後のリスト:", numbers)
```

<details>

<summary>ヒント</summary>

* インデックスを使ってリストを処理するには、`range(len(リスト名))` を使います
* ループ内で `リスト名[インデックス]` の形式でリストの要素にアクセスできます
* 要素の値を更新するには、`リスト名[インデックス] = 新しい値` の形式を使います

</details>

#### 問題 8-5: 条件付きループ

while ループを使って、条件が満たされる限り処理を繰り返すプログラムを作成してください。

```python
# 1. 1 から始めて 10 以下の数字を順番に表示する while ループを書いてください
# カウンター変数を使います


# 2. 10 から始めてカウントダウンし、0 になったら「発射！」と表示する while ループを書いてください


```

<details>

<summary>ヒント</summary>

* `while` ループの基本構文は `while 条件式:` です

- 条件式が `True` である限り、ループが継続されます

* カウンター変数を使って、ループの進行状況を管理します

- ループ内でカウンター変数を更新することを忘れないでください (無限ループになります)

</details>

#### 問題 8-6: break 文の使用

break文を使って、特定の条件でループを終了するプログラムを作成してください。

```python
# 1. 1 から 100 までの数字を順番に表示するループを書く
# ただし、数字が 20 になったらループを終了する


# 2. 以下のリストから数値を順に表示するループを書く
# ただし、0 に到達したらループを終了する
numbers = [5, 8, 12, 0, 4, 9]


```

<details>

<summary>ヒント</summary>

* `break` 文は、ループを即座に終了させます
* `break` は if 文と組み合わせて使うことが多いです
* リストの要素に対しても break 文を使うことができます

</details>

#### 問題 8-7: continue 文の使用

continue 文を使って、特定の条件の場合に次のループへスキップするプログラムを作成してください。

```python
# 1. 1 から 10 までの数字を表示するループをく
# ただし、偶数の場合はスキップして表示しない


# 2. 次のリストから、3文字以上の果物の名前のみを表示する
fruits = ["りんご", "梨", "バナナ", "桃", "ぶどう", "キウイ", "いちご"]


```

<details>

<summary>ヒント</summary>

* `continue` 文は、現在のループの残りの部分をスキップして、次のループの繰り返しへ進みます
* `continue` も if 文と組み合わせて使うことが多いです
* 文字列の長さは `len(文字列)` で取得できます

</details>

#### 問題 8-8: 多重ループ

ループの中にループを入れる (ネストする) プログラムを作成してください。

```python
# 1. 1 から 3 までの数と、'A' から 'C' までの文字のすべての組み合わせを表示する
# 出力例: 「1-A」「1-B」「1-C」「2-A」...「3-C」
letters = ['A', 'B', 'C']


# 2. 九九の一部 (2の段 と 3の段) を表示する


```

<details>

<summary>ヒント</summary>

* ネストしたループでは、外側のループが 1回実行されるごとに、内側のループが完全に実行されます

- 外側のループの変数と内側のループの変数を組み合わせて使います

* 九九の計算では、掛け算 ( `*` 演算子) を使います

- f-string を使うと、計算結果を表示するのに便利です

</details>
